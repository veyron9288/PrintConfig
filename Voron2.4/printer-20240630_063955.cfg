[include fluidd.cfg]
[include printer-macros.cfg]
[include stepper-config.cfg]
[include stealthburner_leds.cfg]
[include IDM.cfg]
[include axis_twist_compensation.cfg]

[exclude_object]

[force_move]
enable_force_move: true

[idle_timeout]
timeout: 1800

[gcode_arcs]  # 允许圆弧插补
resolution: 1.0


[mcu]
# serial: /dev/serial/by-id/<your-mcu-id>
canbus_uuid: 71d938caaee7

[virtual_sdcard]
path: /home/orangepi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[printer]
kinematics: corexy
max_velocity: 500
max_accel: 10000
max_z_velocity: 15
max_z_accel: 300
square_corner_velocity: 5.0


#####################################################################
#   Extruder
#####################################################################

#! In Driver7:E4 Position (Extruder)
[extruder]
step_pin: PB5
dir_pin: !PB4
enable_pin: !PB6
rotation_distance: 23.2812336
gear_ratio: 50:10
microsteps: 16
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: PB1
sensor_type: NTC 100K MGB18-104F39050L32
sensor_pin: PC2
min_temp: 10
max_temp: 290
max_power: 1.0
min_extrude_temp: 170

# pid校准：PID_CALIBRATE HEATER=extruder TARGET=170
#control = pid
#pid_kp = 26.213
#pid_ki = 1.304
#pid_kd = 131.721


[tmc2209 extruder]
uart_pin: PB3
interpolate: false
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0


[verify_heater extruder]       # 加热块温度容差配置
max_error: 120                 # 最大误差
check_gain_time:120            # 容差时间
hysteresis: 50                 # 容差温度
heating_gain: 2                # 加热增益

#####################################################################
#   Bed Heater
#####################################################################
[heater_bed]
heater_pin: PB10
sensor_type: Generic 3950
sensor_pin: PC3                 # Pullup on board
max_power: 1.0
min_temp: 0
max_temp: 150
# pid校准：PID_CALIBRATE HEATER=heater_bed TARGET=60
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769


#####################################################################
#   Fan Control
#####################################################################

[heater_fan 喉管风扇]
pin: PA1
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0
fan_speed: 0.8

[fan]
pin: PA0
max_power: 1.0
kick_start_time: 0.5
off_below: 0.10

[controller_fan 下位机]
pin: PB0
kick_start_time: 0.5
fan_speed: 0.8


[temperature_sensor orangepi]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor monster8]       #显示主板的温度
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100


[safe_z_home]
home_xy_position:150,150
z_hop:10

[bed_mesh]
speed: 300                   # 校准速度
horizontal_move_z: 10        # Z轴运动速度
mesh_min: 35,35              # 最小校准点坐标x，y
mesh_max: 270,270            # 最大校准点坐标x，y
probe_count: 30,30           # 采样点数（4X4为16点）
mesh_pps: 2,2                # 补充采样点数
algorithm: bicubic           # 算法模型
bicubic_tension: 0.2         # 算法插值不要动

[quad_gantry_level]

gantry_corners:
	-60,-10
	360,370
points:
	50,25
	50,225
	250,225
	250,25

speed: 300
horizontal_move_z: 10
retries: 10
retry_tolerance: 0.005
max_adjust: 10


[gcode_macro BED_MESH_CALIBRATE]
rename_existing: _BED_MESH_CALIBRATE
gcode:
    {% set TARGET_TEMP = printer.heater_bed.target %}
    M140 S0
    _BED_MESH_CALIBRATE {rawparams}
    M140 S{TARGET_TEMP}


[gcode_macro QUAD_GANTRY_LEVEL]
rename_existing: _QUAD_GANTRY_LEVEL
gcode:
    SAVE_GCODE_STATE NAME=STATE_QGL
    BED_MESH_CLEAR
    {% if not printer.quad_gantry_level.applied %}
      _QUAD_GANTRY_LEVEL horizontal_move_z=10 retry_tolerance=1
    {% endif %}
    _QUAD_GANTRY_LEVEL horizontal_move_z=2
    G28 Z
    RESTORE_GCODE_STATE NAME=STATE_QGL

[gcode_macro M109]
rename_existing: M99109
gcode:
    {% set s = params.S|float %}
    
    M104 {% for p in params %}{'%s%s' % (p, params[p])}{% endfor %}  ; Set hotend temp
    {% if s != 0 %}
        TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}   ; Wait for hotend temp (within 1 degree)
    {% endif %}


[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    The folder where the results will be stored. It will be created if it doesn't exist.
# number_of_results_to_keep: 3
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
# keep_raw_csv: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
# timeout: 300
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [idm model default]
#*# model_coef = 1.438847036257445,
#*# 	  1.8697901609284728,
#*# 	  0.8191189173145811,
#*# 	  0.35361884317674774,
#*# 	  0.08847370973796737,
#*# 	  0.22726083856557103,
#*# 	  0.16756517052893535,
#*# 	  -0.08106117413272565,
#*# 	  0.03637450977339766,
#*# 	  0.08181451247076588
#*# model_domain = 3.234922877062607e-07,3.344800417083861e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 28.624652
#*# model_offset = 0.16000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.061154, -0.050551, -0.038325, -0.037398, -0.034769, -0.023719, -0.012578, -0.012484, -0.016430, -0.037008, -0.056249, -0.057016, -0.066332, -0.046145, -0.035695, -0.040660, -0.047249, -0.040605, -0.042135, -0.043525, -0.037330, -0.028675, -0.028821, -0.038767, -0.038416, -0.044089, -0.049538, -0.052870, -0.059733, -0.065525
#*# 	-0.058886, -0.048776, -0.040630, -0.034278, -0.030181, -0.028530, -0.015440, -0.005816, -0.016615, -0.040756, -0.057063, -0.065285, -0.045828, -0.041770, -0.039945, -0.034487, -0.036822, -0.041001, -0.042970, -0.043918, -0.036398, -0.023352, -0.014804, -0.032541, -0.042944, -0.042324, -0.041179, -0.040459, -0.043934, -0.054542
#*# 	-0.059106, -0.048555, -0.035987, -0.036934, -0.034956, -0.031695, -0.018218, -0.009935, -0.016401, -0.035118, -0.059042, -0.058180, -0.055715, -0.038775, -0.034062, -0.028249, -0.039454, -0.041416, -0.051622, -0.056822, -0.047925, -0.034365, -0.023221, -0.030814, -0.027813, -0.031925, -0.042645, -0.041208, -0.040489, -0.045288
#*# 	-0.060063, -0.044246, -0.041194, -0.044678, -0.046637, -0.037908, -0.023939, -0.023409, -0.032270, -0.050673, -0.059741, -0.052268, -0.049041, -0.038784, -0.035671, -0.046843, -0.037323, -0.054711, -0.050664, -0.049491, -0.051350, -0.034967, -0.029545, -0.038425, -0.043959, -0.039493, -0.040183, -0.040599, -0.045517, -0.053573
#*# 	-0.063102, -0.052746, -0.045524, -0.045611, -0.042477, -0.043500, -0.025626, -0.024404, -0.029640, -0.041992, -0.056212, -0.060937, -0.048657, -0.042226, -0.042426, -0.043837, -0.048498, -0.060529, -0.056402, -0.057029, -0.051430, -0.041425, -0.031539, -0.036299, -0.040033, -0.042074, -0.048315, -0.044244, -0.046660, -0.054090
#*# 	-0.055622, -0.045383, -0.043057, -0.044194, -0.044880, -0.039596, -0.036527, -0.024323, -0.028171, -0.039852, -0.057588, -0.059067, -0.055397, -0.042975, -0.041055, -0.043594, -0.046887, -0.058628, -0.061299, -0.060839, -0.050905, -0.035060, -0.029203, -0.036393, -0.040844, -0.048605, -0.051188, -0.050951, -0.050510, -0.049972
#*# 	-0.053435, -0.045952, -0.040670, -0.045080, -0.040868, -0.045742, -0.031280, -0.019179, -0.021431, -0.032608, -0.053888, -0.061359, -0.052289, -0.045757, -0.036072, -0.039580, -0.042728, -0.053247, -0.053737, -0.058415, -0.048574, -0.038232, -0.027434, -0.030653, -0.035794, -0.043186, -0.051722, -0.045428, -0.046173, -0.050109
#*# 	-0.054908, -0.046190, -0.040225, -0.041972, -0.049823, -0.045110, -0.025780, -0.020341, -0.028684, -0.051831, -0.059293, -0.062803, -0.052185, -0.043380, -0.042198, -0.041553, -0.039836, -0.046376, -0.051817, -0.049676, -0.037533, -0.022160, -0.015596, -0.029798, -0.038985, -0.046337, -0.051443, -0.049643, -0.050858, -0.048919
#*# 	-0.051304, -0.046852, -0.041483, -0.045007, -0.053120, -0.043464, -0.027638, -0.018957, -0.026283, -0.042646, -0.054977, -0.055808, -0.044385, -0.042904, -0.040357, -0.035811, -0.039026, -0.044756, -0.045888, -0.044639, -0.030308, -0.008362, 0.001207, -0.016670, -0.034702, -0.044099, -0.049105, -0.049210, -0.048424, -0.049623
#*# 	-0.054886, -0.044785, -0.040657, -0.055717, -0.060401, -0.061449, -0.048523, -0.024190, -0.029484, -0.038709, -0.055023, -0.048268, -0.041886, -0.036928, -0.037378, -0.035845, -0.033856, -0.041381, -0.044113, -0.038875, -0.026203, -0.007203, 0.005941, -0.010161, -0.029172, -0.044771, -0.048981, -0.047417, -0.047702, -0.046196
#*# 	-0.050055, -0.044290, -0.040368, -0.050631, -0.062555, -0.066082, -0.050541, -0.023626, -0.021558, -0.033188, -0.043571, -0.046864, -0.034498, -0.025686, -0.026070, -0.032898, -0.035168, -0.041625, -0.044424, -0.038455, -0.015640, -0.005325, -0.002077, -0.004801, -0.016889, -0.035905, -0.038430, -0.045132, -0.040956, -0.043477
#*# 	-0.049871, -0.043014, -0.045346, -0.057350, -0.064974, -0.062870, -0.046079, -0.019148, -0.024318, -0.036828, -0.040558, -0.040009, -0.029962, -0.027307, -0.030724, -0.027438, -0.032126, -0.030369, -0.036470, -0.034841, -0.015041, 0.001854, 0.003018, -0.012435, -0.027993, -0.036034, -0.042287, -0.041379, -0.040067, -0.039477
#*# 	-0.043386, -0.040684, -0.037834, -0.044343, -0.059633, -0.060271, -0.044493, -0.018949, -0.018956, -0.029724, -0.037742, -0.040172, -0.028884, -0.020830, -0.022094, -0.024914, -0.027246, -0.034921, -0.037363, -0.035276, -0.024554, -0.012277, -0.002804, -0.013646, -0.022580, -0.037497, -0.035816, -0.035405, -0.032723, -0.033703
#*# 	-0.043478, -0.041777, -0.037814, -0.048937, -0.051286, -0.049121, -0.032337, -0.010758, -0.021684, -0.034353, -0.040601, -0.039450, -0.027960, -0.015047, -0.019671, -0.021684, -0.024687, -0.031194, -0.033742, -0.027537, -0.019590, -0.010234, -0.004243, -0.021357, -0.030737, -0.035785, -0.036819, -0.035154, -0.034535, -0.031322
#*# 	-0.041144, -0.040560, -0.036656, -0.037424, -0.036489, -0.032616, -0.020641, -0.008916, -0.016504, -0.030583, -0.034398, -0.029854, -0.023441, -0.012330, -0.015733, -0.017911, -0.022288, -0.027810, -0.030567, -0.030545, -0.021298, -0.008007, -0.006099, -0.012352, -0.021565, -0.034166, -0.037005, -0.032353, -0.027059, -0.030636
#*# 	-0.038620, -0.041979, -0.039832, -0.047287, -0.043981, -0.041252, -0.025666, -0.008236, -0.012541, -0.026222, -0.032781, -0.031071, -0.021694, -0.013593, -0.012984, -0.012351, -0.016428, -0.022388, -0.026778, -0.027483, -0.022643, 0.000944, -0.001102, -0.013147, -0.023681, -0.033494, -0.037545, -0.031317, -0.029298, -0.029634
#*# 	-0.037993, -0.041430, -0.038284, -0.041400, -0.035711, -0.037408, -0.025220, -0.015907, -0.012409, -0.023576, -0.032338, -0.031133, -0.022955, -0.014059, -0.012438, -0.012129, -0.013105, -0.022824, -0.026661, -0.022376, -0.013703, 0.002336, 0.001072, -0.005183, -0.015831, -0.027994, -0.032481, -0.032500, -0.025743, -0.027675
#*# 	-0.045422, -0.042058, -0.042256, -0.044435, -0.039091, -0.039647, -0.026384, -0.019542, -0.017444, -0.029581, -0.035879, -0.030883, -0.022301, -0.018217, -0.015502, -0.016697, -0.017328, -0.027188, -0.029089, -0.023599, -0.015442, -0.000239, 0.003666, -0.009291, -0.020884, -0.028946, -0.032935, -0.029236, -0.030305, -0.027313
#*# 	-0.041257, -0.044460, -0.042342, -0.039863, -0.039216, -0.043754, -0.020410, -0.013366, -0.015479, -0.025029, -0.037931, -0.030464, -0.021633, -0.018184, -0.018966, -0.018675, -0.022201, -0.030490, -0.032068, -0.032190, -0.023910, -0.011741, 0.002747, -0.008285, -0.019269, -0.025085, -0.029761, -0.025843, -0.023847, -0.027791
#*# 	-0.049263, -0.044553, -0.044540, -0.044118, -0.037427, -0.041641, -0.019274, -0.016565, -0.018698, -0.028612, -0.040260, -0.033704, -0.029531, -0.022824, -0.024811, -0.028559, -0.027378, -0.034277, -0.037678, -0.034089, -0.022094, -0.009525, -0.000771, -0.012187, -0.020563, -0.025178, -0.028480, -0.024648, -0.024894, -0.028132
#*# 	-0.046791, -0.047141, -0.041741, -0.044792, -0.038209, -0.044834, -0.024029, -0.015035, -0.011346, -0.029275, -0.037699, -0.043435, -0.039276, -0.031452, -0.030746, -0.032811, -0.031130, -0.037845, -0.043083, -0.041874, -0.035662, -0.019028, -0.009182, -0.016925, -0.021740, -0.024802, -0.028846, -0.025618, -0.022891, -0.031057
#*# 	-0.057556, -0.053368, -0.049970, -0.052121, -0.051475, -0.046524, -0.030590, -0.020504, -0.023933, -0.037057, -0.046920, -0.046987, -0.042583, -0.040062, -0.038578, -0.031699, -0.025591, -0.041940, -0.041201, -0.033847, -0.024112, -0.014087, -0.012546, -0.020532, -0.029630, -0.032991, -0.035721, -0.028277, -0.029495, -0.031447
#*# 	-0.047558, -0.046870, -0.044834, -0.052118, -0.051924, -0.049926, -0.039350, -0.026196, -0.020656, -0.037355, -0.044882, -0.050765, -0.048125, -0.040601, -0.038491, -0.037481, -0.031058, -0.028996, -0.034791, -0.037805, -0.033859, -0.023076, -0.018729, -0.023628, -0.030107, -0.037717, -0.036012, -0.031537, -0.028314, -0.030409
#*# 	-0.040573, -0.044138, -0.042384, -0.050632, -0.053892, -0.050403, -0.026440, -0.018963, -0.022370, -0.041420, -0.054772, -0.057090, -0.050865, -0.044148, -0.041449, -0.038853, -0.036379, -0.039365, -0.041324, -0.039549, -0.033897, -0.019392, -0.018750, -0.033105, -0.038024, -0.041670, -0.042627, -0.035943, -0.032343, -0.028623
#*# 	-0.039876, -0.036868, -0.030499, -0.040206, -0.044379, -0.050577, -0.029997, -0.008721, -0.009145, -0.026771, -0.049062, -0.048206, -0.042363, -0.034424, -0.027866, -0.027858, -0.027813, -0.038691, -0.040177, -0.040041, -0.040564, -0.023160, -0.012567, -0.024915, -0.031932, -0.037698, -0.040218, -0.034136, -0.029069, -0.031892
#*# 	-0.046871, -0.041521, -0.038476, -0.043681, -0.047094, -0.046225, -0.022813, -0.010879, -0.010716, -0.028297, -0.047249, -0.048892, -0.043119, -0.031663, -0.022230, -0.016014, -0.012967, -0.025225, -0.027698, -0.026864, -0.014004, -0.002008, -0.000659, -0.016580, -0.032433, -0.038688, -0.039962, -0.032440, -0.030299, -0.025823
#*# 	-0.041393, -0.042383, -0.033899, -0.043755, -0.043609, -0.039846, -0.019982, -0.008452, -0.003985, -0.020512, -0.038127, -0.043412, -0.038845, -0.034038, -0.030341, -0.024868, -0.015929, -0.019063, -0.023633, -0.019610, -0.004906, 0.009025, 0.010811, -0.006865, -0.020680, -0.031346, -0.035380, -0.030083, -0.028422, -0.026238
#*# 	-0.043667, -0.037504, -0.037983, -0.041592, -0.045929, -0.041422, -0.019815, -0.011398, -0.014937, -0.029926, -0.043052, -0.046465, -0.035263, -0.031375, -0.034914, -0.029869, -0.034230, -0.035192, -0.027393, -0.018159, 0.002902, 0.025813, 0.021703, 0.000067, -0.019540, -0.029147, -0.034620, -0.030872, -0.026570, -0.020688
#*# 	-0.040262, -0.045678, -0.038610, -0.041715, -0.037403, -0.038374, -0.013643, -0.010283, -0.014425, -0.028825, -0.045690, -0.046823, -0.039366, -0.031121, -0.036393, -0.030012, -0.031199, -0.029305, -0.023202, -0.011344, 0.009166, 0.025004, 0.029999, 0.010731, -0.005613, -0.022569, -0.024338, -0.023412, -0.022109, -0.015432
#*# 	-0.052975, -0.050063, -0.047165, -0.053360, -0.050150, -0.038652, -0.017321, -0.008680, -0.025631, -0.040478, -0.055028, -0.056200, -0.043841, -0.037724, -0.034904, -0.029936, -0.028390, -0.002910, -0.005850, 0.006791, 0.009483, 0.027601, 0.030677, 0.015966, -0.004195, -0.015297, -0.019580, -0.018376, -0.016575, -0.006199
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 270.0
#*# min_y = 35.0
#*# max_y = 270.0
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 51.512
#*# pid_ki = 2.935
#*# pid_kd = 226.010
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 38.019
#*# pid_ki = 18.104
#*# pid_kd = 19.960
#*#
#*# [input_shaper]
#*# shaper_type_x = ei
#*# shaper_freq_x = 45.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 45.8
#*#
#*# [axis_twist_compensation]
#*# z_compensations = -0.000163, -0.000093, -0.008972, 0.013294, 0.023173, 0.020329, -0.014835, -0.043798, -0.007733, 0.018797
#*# compensation_start_x = 20.0
#*# compensation_end_x = 280.0
